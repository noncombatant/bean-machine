<h1>Lexer: <span id="lexerResult"></span></h1>
<h1>Parser: <span id="parserResult"></span></h1>

<script src="util.js"></script>

<script src="new-search.js"></script>
<script>
"use strict";

const primitiveEqual = function(a, b) {
  return a === b
}

const termsEqual = function(term1, term2) {
  return term1.property === term2.property &&
    term1.value === term2.value &&
    term1.negated === term2.negated
}

const arraysEqual = function(a, b, comparator) {
  if (a.length !== b.length) {
    return false
  }

  for (let i = 0; i < a.length; ++i) {
    if (!comparator(a[i], b[i])) {
      return false
    }
  }
  return true
}

const testLexer = function(string, expectedTokens) {
  const tokens = getTokens(string)
  console.log(string, tokens)
  return arraysEqual(expectedTokens, getTokens(string), primitiveEqual)
}

const string = 'hello:test "very \\"good\\"" "yes":wow "scrunch pumpkin":"goat leg" -goat:no -"short pants"'
const expectedTokens = ['hello:', 'test', 'very "good"', 'yes:', 'wow', 'scrunch pumpkin:', 'goat leg', '-goat:', 'no', '-short pants']

setSingleTextChild(lexerResult, testLexer(string, expectedTokens) ? "Success" : "Failure")

const expectedTerms = [
  { property: 'hello', value: 'test', negated: false },
  { property: '', value: 'very "good"', negated: false },
  { property: 'yes', value: 'wow', negated: false },
  { property: 'scrunch pumpkin', value: 'goat leg', negated: false },
  { property: 'goat', value: 'no', negated: true },
  { property: '', value: 'short pants', negated: true },
]

const lexedTokens = getTokens(string)
const parsedTerms = getTerms(lexedTokens)
console.log(parsedTerms)

setSingleTextChild(parserResult, arraysEqual(parsedTerms, expectedTerms, termsEqual) ? "Success" : "Failure")
</script>
